<!doctype html><html lang="ja"><meta charset="utf-8"><title>Admin</title>
<body><h1>Post an Article</h1>
<label>Admin Token <input id="tok" placeholder="貼り付け"></label><br>
<label>Title <input id="title" style="width:24em"></label><br>
<label>Body <textarea id="body" rows="6" cols="60"></textarea></label><br>
<button id="send">Publish</button><pre id="out"></pre>

<h2>Latest</h2>
<ul id="list"></ul>

<script>
  const tokEl = document.getElementById('tok');
  tokEl.value = localStorage.getItem('ADMIN_TOKEN') || '';
  function saveTok(){ localStorage.setItem('ADMIN_TOKEN', tokEl.value.trim()); }

  async function reloadList(){
    const rows = await (await fetch('./api/articles?limit=20')).json();
    const ul = document.getElementById('list');
    ul.innerHTML = rows.map(a => (
      `<li><b>${a.title}</b> <small>${new Date(a.created_at).toLocaleString()}</small>
       <button data-id="${a.id}" class="del">Delete</button></li>`
    )).join('');
  }

  document.addEventListener('click', async (e)=>{
    if (!e.target.classList.contains('del')) return;
    const id = e.target.getAttribute('data-id');
    if (!confirm('Delete #'+id+' ?')) return;
    saveTok();
    const r = await fetch('./api/articles/'+id, {
      method:'DELETE',
      headers:{'Authorization':'Bearer '+tokEl.value.trim()}
    });
    alert('Delete: '+r.status+' '+r.statusText);
    reloadList();
  });

  document.getElementById('send').onclick = async () => {
    saveTok();
    const title = document.getElementById('title').value.trim();
    const body = document.getElementById('body').value.trim();
    const out = document.getElementById('out');
    if(!tokEl.value.trim()||!title||!body){ out.textContent='必須項目が空です'; return; }
    const r = await fetch('./api/articles', {method:'POST',
      headers:{'Content-Type':'application/json','Authorization':'Bearer '+tokEl.value.trim()},
      body: JSON.stringify({title, body})
    });
    out.textContent = r.status+' '+r.statusText;
    reloadList();
  };

  reloadList();
</script></body></html>
