<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AI Marketing News｜AIニュース・解説</title>
    <meta name="description" content="AIMAメディア｜生成AI・AIマーケの最新ニュースと解説。">
    <link rel="canonical" href="https://ai-and-marketing.jp/media/" />
    <meta property="og:type" content="website">
    <meta property="og:title" content="AI Marketing News｜AIニュース・解説">
    <meta property="og:description" content="生成AI・AIマーケの最新ニュースと実務解説。">
    <meta property="og:url" content="https://ai-and-marketing.jp/media/">
    <meta property="og:image" content="https://ai-and-marketing.jp/media/ogp.png">
    <meta name="twitter:card" content="summary_large_image">
  </head>
  <body>
    <div id="root"></div>
    <section id="latest-articles" style="max-width: 840px; margin: 40px auto; padding: 0 16px;">
      <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 16px;">最新記事</h2>
      <div id="articles-message" style="color:#555; font-size: 0.95rem;">読み込み中…</div>
      <ul id="articles-list" style="list-style: none; padding: 0; margin: 0;"></ul>
    </section>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      (function () {
        const API_URL = 'https://ai-news-cms.onrender.com/api/articles?limit=10';
        const listEl = document.getElementById('articles-list');
        const msgEl = document.getElementById('articles-message');

        function formatJST(dateStr) {
          try {
            const d = new Date(dateStr);
            if (isNaN(d.getTime())) return '';
            return d.toLocaleDateString('ja-JP', { timeZone: 'Asia/Tokyo', year: 'numeric', month: '2-digit', day: '2-digit' });
          } catch (_) {
            return '';
          }
        }

        function toText(html) {
          if (!html) return '';
          return String(html).replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();
        }

        function excerpt(text, max = 120) {
          if (!text) return '';
          const t = text.slice(0, max);
          return t + (text.length > max ? '…' : '');
        }

        async function load() {
          try {
            const res = await fetch(API_URL, { headers: { 'accept': 'application/json' } });
            if (!res.ok) throw new Error('Bad response');
            const data = await res.json();
            const items = Array.isArray(data) ? data : (Array.isArray(data?.articles) ? data.articles : []);

            if (!items.length) {
              msgEl.textContent = '記事がありません';
              return;
            }

            msgEl.style.display = 'none';

            for (const article of items) {
              const id = article.id ?? article._id ?? article.slug ?? '';
              const title = article.title ?? '無題';
              const created = article.createdAt ?? article.publishedAt ?? article.date ?? '';
              const body = article.content ?? article.body ?? article.description ?? '';

              const li = document.createElement('li');
              li.style.padding = '16px 0';
              li.style.borderBottom = '1px solid #eee';

              const a = document.createElement('a');
              a.href = `https://ai-news-cms.onrender.com/article.html?id=${encodeURIComponent(id)}`;
              a.textContent = title;
              a.style.fontWeight = '600';
              a.style.fontSize = '1.05rem';
              a.style.color = '#1a1a1a';
              a.style.textDecoration = 'none';
              a.onmouseenter = () => (a.style.textDecoration = 'underline');
              a.onmouseleave = () => (a.style.textDecoration = 'none');

              const meta = document.createElement('div');
              meta.textContent = formatJST(created);
              meta.style.color = '#666';
              meta.style.fontSize = '0.85rem';
              meta.style.margin = '6px 0 6px';

              const p = document.createElement('p');
              p.textContent = excerpt(toText(body), 120);
              p.style.margin = '0';
              p.style.color = '#333';
              p.style.lineHeight = '1.7';

              li.appendChild(a);
              li.appendChild(meta);
              li.appendChild(p);
              listEl.appendChild(li);
            }
          } catch (e) {
            console.error(e);
            msgEl.textContent = '記事の取得に失敗しました';
          }
        }

        // Kick off
        load();
      })();
    </script>
  </body>
</html>
